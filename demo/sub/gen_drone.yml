---
kind: pipeline
type: docker
name: demo-pipeline-with-sub

platform:
  os: linux
  arch: amd64

steps:
- name: step-1
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=7 -build-id=$DRONE_BUILD_NUMBER ./demo/sub

- name: step-2
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=8 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - step-1

- name: step-3
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=9 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - step-2

- name: step-4
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=13 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - step-3

- name: step-5
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=14 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - step-3

- name: step-6
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=15 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - step-3

---
kind: pipeline
type: docker
name: sub-pipeline-0

platform:
  os: linux
  arch: amd64

steps:
- name: sub-step-1
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=1 -build-id=$DRONE_BUILD_NUMBER ./demo/sub

- name: sub-step-2
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=3 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - sub-step-1

- name: sub-step-3
  image: ghcr.io/grafana/shipwright:latest
  commands:
  - shipwright -step=4 -build-id=$DRONE_BUILD_NUMBER ./demo/sub
  depends_on:
  - sub-step-1

...
